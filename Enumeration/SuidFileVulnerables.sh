#!/bin/bash




#Colours
greenColour="\e[0;32m\033[1m"
endColour="\033[0m\e[0m"
redColour="\e[0;31m\033[1m"
blueColour="\e[0;34m\033[1m"
yellowColour="\e[0;33m\033[1m"
purpleColour="\e[0;35m\033[1m"
turquoiseColour="\e[0;36m\033[1m"
grayColour="\e[0;37m\033[1m"



function printArray () {
	local array=("$@")
for i in "${array[@]}";
do
echo $i


done


}



function suid {
suidFiles=($(find / -perm -u=s -type f 2>/dev/null | grep -v '/snap' |  grep -v '/lib' | grep 'bin'))

if [[ ${#suidFiles[@]} > 0 ]];
then

	gtfo=($(curl -s 'https://gtfobins.github.io/' | grep '\".*/.*/#' -oh | sed 's/\// /g' | awk '{print $3}' | sort | uniq))
	countGtfo=$(curl -s 'https://gtfobins.github.io/' | grep '\".*/.*/#' -oh | sed 's/\// /g' | awk '{print $3}' | sort | uniq | wc -w) 
	vulnerablesBinPath=()
	vulnerablesBin=()

	for (( index=0; index<${#suidFiles[@]}; index++ ))
	do
		bin=$(echo ${suidFiles[$index]} | sed 's/\//\n/g' | tail -1)
		
		url="https://gtfobins.github.io/gtfobins/$bin/"
		gtfo=$(curl -s $url | grep suid)
		if [[ $gtfo ]]
		then
				vulnerablesBinPath+=("${suidFiles[$index]}")
				vulnerablesBin+=("$bin")
		fi
	done

	if [[ ${#vulnerablesBinPath[@]} > 0 ]];
	then
		echo -e "${blueColour}--------------------------------------------------------------------------------------------------------------------"
		echo -e "|                                                                                                                  |"
		echo -e "|                 SUID vulnerable binaries                                                                         |"
		echo -e "|                                                                                                                  |"
		echo -e "-------------------------------------------------------------------------------------------------------------------- "
		echo -e "|                   Binary            |        Exploit command                                                     |"
		echo -e "--------------------------------------------------------------------------------------------------------------------${endColour}"
		
		echo -e "${greenColour}--------------------------------------------------------------------------------------------------------------------"
		for (( index=0; index<${#vulnerablesBinPath[@]}; index++  ))
		do
		echo "|		${vulnerablesBinPath[$index]}                https://gtfobins.github.io/gtfobins/${vulnerablesBin[$index]}/#suid"
		echo "--------------------------------------------------------------------------------------------------------------------"
		done
	fi

else
    echo "The system has not suid files."
fi
}
