import os, re, sys, json

ULS_INT_CHAIN1 = 0
ULS_INT_CHAIN2 = 1

def main():
    # read file
    with open('network-map.json', 'r') as myfile:
        data=myfile.read()

    # parse file
    jsonO = json.loads(data)
    ch1Net = jsonO[ULS_INT_CHAIN1]['map']
    ch1Name = jsonO[ULS_INT_CHAIN1]['networkName']
    ch2Net = jsonO[ULS_INT_CHAIN2]['map']
    ch2Name = jsonO[ULS_INT_CHAIN2]['networkName']

    for galD in ch1Net:
        for host in galD['galD']['hosts']:
            ipAddr = host['ipAddr']
            protocol = 'tcp'
            for port in range(1,65535):
                os.system('timeout 1 bash -c \'</dev/%s/%s/%s &>/dev/null\' && echo \'Port %s is OPEN\' > out.txt' % (protocol, ipAddr, port, ipAddr))

    outputFile = open('out.txt', r)
    print(outputFile.readlines())


if __name__ == "__main__":
    main()